function Sequence(e,t,n){function a(i,t){if(f=i,"undefined"==typeof t)var t={showLineNumbers:!0,wrapAminoAcids:!0,charsPerLine:50,search:!1,toolbar:!1,id:"id"};else m=t;w="undefined"==typeof t.charsPerLine?50:t.charsPerLine,k="sequenceHeader_"+t.id,L="inputSearchSeq_"+t.id,q="sequenceBody_"+t.id,S="scroller_"+t.id,_="charNumbers_"+t.id,C="fastaSeq_"+t.id,A="coverageLegend_"+t.id,P="sequenceToolbar_"+t.id,E="CPLChoice_"+t.id,F="peptideHighlighted_"+t.id,z="stringSelected_"+t.id;var n="<div id="+k+' class="row" style="border-bottom: 1px solid #E7EAEC;padding-bottom:5px;margin:0px 0px 15px"><div><h3 style="color:#DF0101;display:inline-block;vertical-align:middle;">'+b+'</h3><br /><span style="color:#084B8A;padding:8px 5px;background-color:white;margin-right:10px;vertical-align:middle;">Location:'+t.location+'</span><span style="color:#298A08;padding:8px 5px;background-color:white;margin-right:10px;vertical-align:middle;">Length: {{sequenceLength}} bp</span>';t.flank>0&&(n+='<span style="color:#DF7401;padding:8px 5px;background-color:white;margin-right:10px;vertical-align:middle;">Flank Length:'+t.flank+"bp</span>"),t.revComp===!0&&(n+='<span style="color:#a05ce0;padding:8px 5px;background-color:white;margin-right:10px;vertical-align:middle;">ReverseComplemented</span>'),n+="</div><br /></div><div id="+q+' style="margin-top: 5px;"><div id='+S+' style="max-height:400px;overflow:auto;white-space: nowrap;padding-right:20px;margin-right:10px;s"><div id='+_+' style="font-family: monospace;font-size: 13px;display:inline-block;text-align:right; padding-right:5px; border-right:1px solid LightGray;"></div><div id='+C+' display-option="'+w+'" style="font-family: monospace;font-size: 13px;display:inline-block;padding:5px;">{{{sequence}}}</div></div><div id='+A+' style="margin-top: 10px;margin-left:15px;"></div></div>';var a=Handlebars.compile(n),r=a({sequence:e,sequenceLength:e.length});$(i).html(r),t.wrapAminoAcids!==!1?c(i+" #"+C):$(i+" #"+S).css("overflow-x","auto"),t.showLineNumbers!==!1&&p(i+" #"+C,i+" #"+_),t.search&&g(),t.toolbar&&(v(),""!==x&&$(f+" #"+P).append('<a class="btn btn-default" href="http://www.nextprot.org/db/entry/'+x.split("-")[0]+"/fasta?isoform="+x.slice(3)+'" style="margin-left:15px;">view Fasta</a><a class="btn btn-default disabled" href="" style="margin-left:15px;">Blast sequence</a><a class="btn btn-default disabled" href="" style="margin-left:15px;">Blast selection</a>')),y=$(i+" #"+C).html()}function r(e,i,t){var n=[e,i],a=y;n[0]=n[0]+~~(n[0]/10)+4*~~(n[0]/w),n[1]=n[1]+~~(n[1]/10)+4*~~(n[1]/w);a=a.substring(0,n[0])+"<span id="+z+' style="background:'+t+';color:white;">'+a.substring(n[0],n[1])+"</span>"+a.substring(n[1],a.length),$(f+" #"+C).html(a)}function s(e,t){(new Date).getTime();0===e.length&&$(f+" #"+C).html(y);var n=y,a=n.toString(),r=0,s=0;for(i in e)r=o(e[i].start),s=o(e[i].end),a=a.substring(0,r)+"<span class='stringsSelected' style=\"background:"+t+';color:white;">'+a.substring(r,s)+"</span>"+a.substring(s,a.length);$(f+" #"+C).html(a)}function l(e){for(var i=0;i<e.length;i++)$(f+" #"+A).append(e[i].underscore===!0?'<div style="display:inline-block;background:'+e[i].color+';width:20px;height:20px;vertical-align:middle;margin:0px 5px 0px 10px;border-radius:50%; border: 1px solid grey;text-align:center; line-height:0.8;">_</div><p style="display:inline-block;font-weight:bold;font-size:11px;font-style:italic;margin:0;padding-top:3px;vertical-align:top;">'+e[i].name+"</p></div>":'<div style="display:inline-block;background:'+e[i].color+';width:20px;height:20px;vertical-align:middle;margin:0px 5px 0px 10px;border-radius:50%;"></div><p style="display:inline-block;font-weight:bold;font-size:11px;font-style:italic;margin:0;padding-top:3px;vertical-align:top;">'+e[i].name+"</p>")}function o(e){var i=e+~~(e/10)+4*~~(e/w);return i}function d(e,i,t,n){e.sort(function(e,i){return e.start-i.start});(new Date).getTime();if(!i)var i=0;if(!t)var t=0;if(!n)var n="#FFE5A3";for(var a="",r="",s=0;s<e.length;s++)e[s].underscore?(r='<span style="text-decoration:underline;color:'+e[s].color+';">',a+=r):(r='<span style="color:'+e[s].color+';">',a+=r),t?i>=e[s].start&&i<e[s].end&&t>=e[s].start&&t<e[s].end?(a+=y.substring(o(e[s].start),o(i))+"<span id="+F+' style="background:'+n+';">'+y.substring(o(i),o(t+1)),a+="</span>"+y.substring(o(t+1),o(e[s].end))+"</span>"):a+=i>=e[s].start&&i<e[s].end?y.substring(o(e[s].start),o(i))+"</span><span id="+F+' style="background:'+n+';">'+r+y.substring(o(i),o(e[s].end))+"</span>":t>=e[s].start&&t<e[s].end?y.substring(o(e[s].start),o(t+1))+"</span></span>"+r+y.substring(o(t+1),o(e[s].end))+"</span>":y.substring(o(e[s].start),o(e[s].end))+"</span>":a+=y.substring(o(e[s].start),o(e[s].end))+"</span>";$(f+" #"+C).html(a)}function p(e,i){for(var t=$(e).html().split("<br>"),n=parseInt($(e).attr("display-option")),a=[],r=0,s=0;s<t.length;s++)a.push(r+1+"<br>"),r+=n;$(i).html(a.join(""))}function c(e){var i=parseInt($(e).attr("display-option"));i=(i+i/10).toString();var t=$(e).html();t=t.toString().match(/.{1,10}/g).join(" ").match(new RegExp(".{1,"+i+"}","g")).join("<br>"),$(e).html(t)}function g(){$(f+" #"+k).append("<div><input id="+L+' type="text" class="form-control pull-left" style="width:40%;margin-top:3px;" placeholder="Search in sequence.. (Regex supported)"></div>'),h()}function h(){$(f+" #"+L).keyup(function(){var i=$(this).val();if(""!==i){for(var t,n=new RegExp(i,"gi"),a=[],r=-1;null!=(t=n.exec(e))&&t.index>r&&t.index<e.length;)r=t.index,a.push({start:t.index,end:t.index+t[0].length});a.sort(function(e,i){return i.start-e.start}),s(a,"#C50063")}else $(f+" #"+C).html(y)})}function u(e){var i=m;i.charsPerLine=e.value,a(f,i)}function v(){var e=["50","60","70","80","90","100"],i='<div class="form-inline" role="form"><div id='+P+' class="row"style="margin-bottom:15px;"><div class="input-group" style="margin-left:20px;"> <span class="input-group-addon">Char per line</i></span><select id='+E+' class="form-control" style="border-top-left-radius: 0px;border-bottom-left-radius: 0px;"><option>Select</option>{{#each CPL}}<option value={{this}}>{{this}}</option>{{/each}}</select></div></div></div>',t=Handlebars.compile(i),n=t({CPL:e});$(f+" #"+q).prepend(n),$(f+" #"+E).change(function(){u(this),$(f+" #"+E+" option:selected").text($(this).val())})}var x;x=void 0!==n?n:"";var b;b=void 0!==t?t:"Sequence";var f,m,e=e,y="",w=0,k="",L="",q="",S="",_="",C="",A="",P="",E="",F="",z="";return{render:a,selection:r,coverage:d,addLegend:l}}
