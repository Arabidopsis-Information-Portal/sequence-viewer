/*! sequence-viewer 2015-09-01 */
function Sequence(a,b,c,d){function e(c,d){if(t=c,"undefined"==typeof d)var d={showLineNumbers:!0,wrapAminoAcids:!0,charsPerLine:50,search:!1,toolbar:!1,id:"id"};else u=d;w="undefined"==typeof d.charsPerLine?50:d.charsPerLine,x="sequenceHeader_"+d.id,y="inputSearchSeq_"+d.id,z="sequenceBody_"+d.id,A="scroller_"+d.id,B="charNumbers_"+d.id,C="fastaSeq_"+d.id,D="coverageLegend_"+d.id,E="sequenceToolbar_"+d.id,F="CPLChoice_"+d.id,G="peptideHighlighted_"+d.id,H="stringSelected_"+d.id;var e="<div id="+x+' class="row" style="border-bottom: 1px solid #E7EAEC;padding-bottom:5px;margin:0px 0px 15px"><div><h3 style="color:#DF0101;display:inline-block;vertical-align:middle;">'+s+'</h3><br /><span style="color:#084B8A;padding:8px 5px;background-color:white;margin-right:10px;vertical-align:middle;">Location:'+d.location+'</span><span style="color:#298A08;padding:8px 5px;background-color:white;margin-right:10px;vertical-align:middle;">Length: {{sequenceLength}} bp</span>';d.flank>0&&(e+='<span style="color:#DF7401;padding:8px 5px;background-color:white;margin-right:10px;vertical-align:middle;">Flank Length:'+d.flank+"bp</span>"),d.revComp===!0&&(e+='<span style="color:#a05ce0;padding:8px 5px;background-color:white;margin-right:10px;vertical-align:middle;">ReverseComplemented</span>'),e+="</div><br /></div><div id="+z+' style="margin-top: 5px;"><div id='+A+' style="max-height:400px;overflow:auto;white-space: nowrap;padding-right:20px;margin-right:10px;s"><div id='+B+' style="font-family: monospace;font-size: 13px;display:inline-block;text-align:right; padding-right:5px; border-right:1px solid LightGray;"></div><div id='+C+' display-option="'+w+'" style="font-family: monospace;font-size: 13px;display:inline-block;padding:5px;">{{{sequence}}}</div></div><div id='+D+' style="margin-top: 10px;margin-left:15px;"></div></div>';var f=Handlebars.compile(e),g=f({sequence:b,sequenceLength:b.length});a(c).html(g),d.wrapAminoAcids!==!1?m(c+" #"+C):a(c+" #"+A).css("overflow-x","auto"),d.showLineNumbers!==!1&&l(c+" #"+C,c+" #"+B),d.search&&n(),d.toolbar&&(q(),""!==r&&a(t+" #"+E).append('<a class="btn btn-default" href="http://www.nextprot.org/db/entry/'+r.split("-")[0]+"/fasta?isoform="+r.slice(3)+'" style="margin-left:15px;">view Fasta</a><a class="btn btn-default disabled" href="" style="margin-left:15px;">Blast sequence</a><a class="btn btn-default disabled" href="" style="margin-left:15px;">Blast selection</a>')),v=a(c+" #"+C).html()}function f(b,c,d,e){var f=[b,c],g=v;f[0]=f[0]+~~(f[0]/10)+4*~~(f[0]/w),f[1]=f[1]+~~(f[1]/10)+4*~~(f[1]/w);g=g.substring(0,f[0])+"<span id="+H+' style="background:'+d+';color:white;">'+g.substring(f[0],f[1])+"</span>"+g.substring(f[1],g.length),a(t+" #"+C).html(g)}function g(b,c,d){(new Date).getTime();0===b.length&&a(t+" #"+C).html(v);var e=v,f=e.toString(),g=0,h=0;for(i in b)g=j(b[i].start),h=j(b[i].end),f=f.substring(0,g)+"<span class='stringsSelected' style=\"background:"+c+';color:white;">'+f.substring(g,h)+"</span>"+f.substring(h,f.length);a(t+" #"+C).html(f)}function h(b){for(var c=0;c<b.length;c++)b[c].underscore===!0?a(t+" #"+D).append('<div style="display:inline-block;background:'+b[c].color+';width:20px;height:20px;vertical-align:middle;margin:0px 5px 0px 10px;border-radius:50%; border: 1px solid grey;text-align:center; line-height:0.8;">_</div><p style="display:inline-block;font-weight:bold;font-size:11px;font-style:italic;margin:0;padding-top:3px;vertical-align:top;">'+b[c].name+"</p></div>"):a(t+" #"+D).append('<div style="display:inline-block;background:'+b[c].color+';width:20px;height:20px;vertical-align:middle;margin:0px 5px 0px 10px;border-radius:50%;"></div><p style="display:inline-block;font-weight:bold;font-size:11px;font-style:italic;margin:0;padding-top:3px;vertical-align:top;">'+b[c].name+"</p>")}function j(a){var b=a+~~(a/10)+4*~~(a/w);return b}function k(b,c,d,e){b.sort(function(a,b){return a.start-b.start});(new Date).getTime();if(!c)var c=0;if(!d)var d=0;if(!e)var e="#FFE5A3";for(var f="",g="",h=0;h<b.length;h++)b[h].underscore?(g='<span style="text-decoration:underline;color:'+b[h].color+';">',f+=g):(g='<span style="color:'+b[h].color+';">',f+=g),d?c>=b[h].start&&c<b[h].end&&d>=b[h].start&&d<b[h].end?(f+=v.substring(j(b[h].start),j(c))+"<span id="+G+' style="background:'+e+';">'+v.substring(j(c),j(d+1)),f+="</span>"+v.substring(j(d+1),j(b[h].end))+"</span>"):f+=c>=b[h].start&&c<b[h].end?v.substring(j(b[h].start),j(c))+"</span><span id="+G+' style="background:'+e+';">'+g+v.substring(j(c),j(b[h].end))+"</span>":d>=b[h].start&&d<b[h].end?v.substring(j(b[h].start),j(d+1))+"</span></span>"+g+v.substring(j(d+1),j(b[h].end))+"</span>":v.substring(j(b[h].start),j(b[h].end))+"</span>":f+=v.substring(j(b[h].start),j(b[h].end))+"</span>";a(t+" #"+C).html(f)}function l(b,c){for(var d=a(b).html().split("<br>"),e=parseInt(a(b).attr("display-option")),f=[],g=0,h=0;h<d.length;h++)f.push(g+1+"<br>"),g+=e;a(c).html(f.join(""))}function m(b){var c=parseInt(a(b).attr("display-option"));c=(c+c/10).toString();var d=a(b).html();d=d.toString().match(/.{1,10}/g).join(" ").match(new RegExp(".{1,"+c+"}","g")).join("<br>"),a(b).html(d)}function n(){a(t+" #"+x).append("<div><input id="+y+' type="text" class="form-control pull-left" style="width:40%;margin-top:3px;" placeholder="Search in sequence.. (Regex supported)"></div>'),o()}function o(){a(t+" #"+y).keyup(function(){var c=a(this).val();if(""!==c){for(var d,e=new RegExp(c,"gi"),f=[],h=-1;null!=(d=e.exec(b))&&d.index>h&&d.index<b.length;)h=d.index,f.push({start:d.index,end:d.index+d[0].length});f.sort(function(a,b){return b.start-a.start}),g(f,"#C50063")}else a(t+" #"+C).html(v)})}function p(a){var b=u;b.charsPerLine=a.value,e(t,b)}function q(){var b=["50","60","70","80","90","100"],c='<div class="form-inline" role="form"><div id='+E+' class="row"style="margin-bottom:15px;"><div class="input-group" style="margin-left:20px;"> <span class="input-group-addon">Char per line</i></span><select id='+F+' class="form-control" style="border-top-left-radius: 0px;border-bottom-left-radius: 0px;"><option>Select</option>{{#each CPL}}<option value={{this}}>{{this}}</option>{{/each}}</select></div></div></div>',d=Handlebars.compile(c),e=d({CPL:b});a(t+" #"+z).prepend(e),a(t+" #"+F).change(function(){p(this),a(t+" #"+F+" option:selected").text(a(this).val())})}var r;r=void 0!==d?d:"";var s;s=void 0!==c?c:"Sequence";var t,u,b=b,v="",w=0,x="",y="",z="",A="",B="",C="",D="",E="",F="",G="",H="";return{render:e,selection:f,coverage:k,addLegend:h}}